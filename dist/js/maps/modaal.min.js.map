{"version":3,"file":"modaal.min.js","sources":["modaal.js"],"sourcesContent":["/*!\n\tModaal - accessible modals - v0.4.4\n\tby Humaan, for all humans.\n\thttp://humaan.com\n */\n/**\n\tModaal jQuery Plugin : Accessible Modals\n\n\t==== General Options ===\n\ttype (string) \t\t\t\t\t: ajax, inline, image, iframe, confirm. Defaults to 'inline'\n\tcontent_source (stribg)\t\t\t: Accepts a string value for your target element, such as '#my-content'. This allows for when trigger element is\n\t\t\t\t\t\t\t\t\t\tan `<a href=\"#\">` link. Not to be confused with the already existing `source` event.\n\tanimation (string) \t\t\t\t: Fade, expand, down, up. Defaults to 'fade'\n\tafter_callback_delay (integer)\t: Specify a delay value for the after open callbacks. This is necessary because with the bundled animations\n\t\t\t\t\t\t\t\t\t\thave a set duration in the bundled CSS. Specify a delay of the same amount as the animation duration in so\n\t\t\t\t\t\t\t\t\t\tmore accurately fire the after open/close callbacks. Defaults 350, does not apply if animation is 'none',\n\t\t\t\t\t\t\t\t\t\tafter open callbacks are dispatched immediately\n\n\tis_locked (boolean)\t\t\t\t: Set this to true to disable closing the modal via keypress or clicking the background. Beware that if\n\t\t\t\t\t\t\t\t\t\ttype != 'confirm' there will be no interface to dismiss the modal if is_locked = true, you'd have to\n\t\t\t\t\t\t\t\t\t\tprogrammatically arrange to dismiss the modal. Confirm modals are always locked regardless of this option\n\t\t\t\t\t\t\t\t\t\tDefaults to false\n\n\thide_close (boolean)\t\t\t: Set this to true to hide the close modal button. Key press and overlay click will still close the modal.\n\t\t\t\t\t\t\t\t\t\tThis method is best used when you want to put a custom close button inside the modal container space.\n\n\tbackground (string)\t\t\t\t: Background overlay style. Defaults to '#000'\n\toverlay_opacity (float) \t\t: Background overlay transparency. Defaults to 0.8\n\toverlay_close (boolean)\t\t\t: Set this to false if you want to disable click to close on overlay background.\n\n\taccessible_title (string)\t\t: Accessible title. Default 'Dialog Window'\n\tstart_open (boolean)\t\t\t: Set this to true to launch the Modaal window immediately on page open\n\tfullscreen (boolean)\t\t\t: Set this to true to make the modaal fill the entire screen, false will default to own width/height attributes.\n\tcustom_class (string)\t\t\t: Fill in this string with a custom class that will be applied to the outer most modal wrapper.\n\n\twidth (integer)\t\t\t\t\t: Desired width of the modal. Required for iframe type. Defaults to undefined //TODO\n\theight (integer)\t\t\t\t: Desired height of the modal. Required for iframe type. Defaults to undefined //TODO\n\n\tbackground_scroll (boolean)\t\t: Set this to true to enable the page to scroll behind the open modal.\n\n    should_open (boolean|function)  : Boolean or closure that returns a boolean to determine whether to open the modal or not.\n\n\tclose_text\t\t\t\t\t\t: String for close button text. Available for localisation and alternative languages to be used.\n\tclose_aria_label\t\t\t\t: String for close button aria-label attribute (value that screen readers will read out). Available for localisation and alternative languages to be used.\n\n\t=== Events ===\n\tbefore_open (function) \t\t\t: Callback function executed before modal is opened\n\tafter_open (function)\t\t\t: Callback function executed after modal is opened\n\tbefore_close (function)\t\t\t: Callback function executed before modal is closed\n\tafter_close (function)\t\t\t: Callback function executed after modal is closed\n\tsource (function(element, src))\t: Callback function executed on the default source, it is intended to transform the\n\t\t\t\t\t\t\t\t\t\tsource (href in an AJAX modal or iframe). The function passes in the triggering element\n\t\t\t\t\t\t\t\t\t\tas well as the default source depending of the modal type. The default output of the\n\t\t\t\t\t\t\t\t\t\tfunction is an untransformed default source.\n\n\n\t=== Confirm Options & Events ===\n\tconfirm_button_text (string)\t: Text on the confirm button. Defaults to 'Confirm'\n\tconfirm_cancel_button_text (string) : Text on the confirm modal cancel button. Defaults to 'Cancel'\n\tconfirm_title (string)\t\t\t: Title for confirm modal. Default 'Confirm Title'\n\tconfirm_content (string)\t\t: HTML content for confirm message\n\tconfirm_callback (function)\t\t: Callback function for when the confirm button is pressed as opposed to cancel\n\tconfirm_cancel_callback (function) : Callback function for when the cancel button is pressed\n\n\n\t=== Gallery Options & Events ===\n\tgallery_active_class (string)\t: Active class applied to the currently active image or image slide in a gallery 'gallery_active_item'\n\touter_controls (boolean)\t\t: Set to true to put the next/prev controls outside the Modaal wrapper, at the edges of the browser window.\n\tbefore_image_change (function)\t: Callback function executed before the image slide changes in a gallery modal. Default function( current_item, incoming_item )\n\tafter_image_change (function)\t: Callback function executed after the image slide changes in a gallery modal. Default function ( current_item )\n\n\n\t=== AJAX Options & Events ===\n\tloading_content (string)\t\t: HTML content for loading message. Default 'Loading &hellip;'\n\tloading_class (string)\t\t\t: Class name to be applied while content is loaded via AJAX. Default 'is_loading'\n\tajax_error_class (string)\t\t: Class name to be applied when content has failed to load. Default is 'modaal-error'\n\tajax_success (function)\t\t \t: Callback for when AJAX content is loaded in\n\n\n\t=== SOCIAL CONTENT ===\n\tinstagram_id (string)\t\t\t: Unique photo ID for an Instagram photo.\n\n*/\n( function( $ ) {\n\n\tvar modaal_loading_spinner = '<div class=\"modaal-loading-spinner\"><div><div></div></div><div><div></div></div><div><div></div></div><div><div></div></div><div><div></div></div><div><div></div></div><div><div></div></div><div><div></div></div></div>'\n\t\n\tvar Modaal = {\n\t\tinit : function(options, elem) {\n\t\t\tvar self = this;\n\n\t\t\tself.dom = $('body');\n\n\t\t\tself.$elem = $(elem);\n\t\t\tself.options = $.extend({}, $.fn.modaal.options, self.$elem.data(), options);\n\t\t\tself.xhr = null;\n\n\t\t\t// set up the scope\n\t\t\tself.scope = {\n\t\t\t\tis_open: false,\n\t\t\t\tid: 'modaal_' + ( new Date().getTime() ) + ( Math.random().toString(16).substring(2) ),\n\t\t\t\tsource: self.options.content_source ? self.options.content_source : self.$elem.attr('href')\n\t\t\t};\n\n\t\t\t// add scope attribute to trigger element\n\t\t\tself.$elem.attr('data-modaal-scope', self.scope.id);\n\n\t\t\t// private options\n\t\t\tself.private_options = {\n\t\t\t\tactive_class: 'is_active'\n\t\t\t};\n\n\t\t\tself.lastFocus = null;\n\t\t\t\n\t\t\t// if is_locked\n\t\t\tif ( self.options.is_locked || self.options.type == 'confirm' || self.options.hide_close ) {\n\t\t\t\tself.scope.close_btn = '';\n\t\t\t} else {\n\t\t\t\tself.scope.close_btn = '<button type=\"button\" class=\"modaal-close\" id=\"modaal-close\" aria-label=\"' + self.options.close_aria_label + '\"><span>' + self.options.close_text + '</span></button>';\n\t\t\t}\n\n\t\t\t// reset animation_speed\n\t\t\tif (self.options.animation === 'none' ){\n\t\t\t\tself.options.animation_speed = 0;\n\t\t\t\tself.options.after_callback_delay = 0;\n\t\t\t}\n\n\t\t\t// On click to open modal\n\t\t\t$(elem).on('click.Modaal', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tself.create_modaal(self, e);\n\t\t\t});\n\n\t\t\t// Define next/prev buttons\n\t\t\tif (self.options.outer_controls === true) {\n\t\t\t\tvar mod_class = 'outer';\n\t\t\t} else {\n\t\t\t\tvar mod_class = 'inner';\n\t\t\t}\n\t\t\tself.scope.prev_btn = '<button type=\"button\" class=\"modaal-gallery-control modaal-gallery-prev modaal-gallery-prev-' + mod_class + '\" id=\"modaal-gallery-prev\" aria-label=\"Previous image (use left arrow to change)\"><span>Previous Image</span></button>';\n\t\t\tself.scope.next_btn = '<button type=\"button\" class=\"modaal-gallery-control modaal-gallery-next modaal-gallery-next-' + mod_class + '\" id=\"modaal-gallery-next\" aria-label=\"Next image (use right arrow to change)\"><span>Next Image</span></button>';\n\n\t\t\t// Check for start_open\n\t\t\tif (self.options.start_open === true ){\n\t\t\t\tself.create_modaal( self );\n\t\t\t}\n\t\t},\n\n\t\t// Initial create to determine which content type it requires\n\t\t// ----------------------------------------------------------------\n\t\tcreate_modaal : function(self, e) {\n\t\t\tvar self = this;\n\t\t\tvar source;\n\n\t\t\t// Save last active state before modal\n\t\t\tself.lastFocus = self.$elem;\n\n\t\t\tif ( self.options.should_open === false || ( typeof self.options.should_open === 'function' && self.options.should_open() === false ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// CB: before_open\n\t\t\tself.options.before_open.call(self, e);\n\n\t\t\tswitch (self.options.type) {\n\t\t\t\tcase 'inline':\n\t\t\t\t\tself.create_basic();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'ajax':\n\t\t\t\t\tsource = self.options.source( self.$elem, self.scope.source );\n\t\t\t\t\tself.fetch_ajax( source );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'confirm':\n\t\t\t\t\tself.options.is_locked = true;\n\t\t\t\t\tself.create_confirm();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'image':\n\t\t\t\t\tself.create_image();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'iframe':\n\t\t\t\t\tsource = self.options.source( self.$elem, self.scope.source );\n\t\t\t\t\tself.create_iframe( source );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'video':\n\t\t\t\t\tself.create_video(self.scope.source);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'instagram':\n\t\t\t\t\tself.create_instagram();\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// call events to be watched (click, tab, keyup, keydown etc.)\n\t\t\tself.watch_events();\n\t\t},\n\n\t\t// Watching Modal\n\t\t// ----------------------------------------------------------------\n\t\twatch_events : function() {\n\t\t\tvar self = this;\n\n\t\t\tself.dom.off('click.Modaal keyup.Modaal keydown.Modaal');\n\n\t\t\t// Body keydown\n\t\t\tself.dom.on('keydown.Modaal', function(e) {\n\t\t\t\tvar key = e.keyCode;\n\t\t\t\tvar target = e.target;\n\n\t\t\t\t// look for tab change and reset focus to modal window\n\t\t\t\t// done in keydown so the check fires repeatedly when you hold the tab key down\n\t\t\t\tif (key == 9 && self.scope.is_open) {\n\t\t\t\t\tif (!$.contains(document.getElementById(self.scope.id), target) ) {\n\t\t\t\t\t\t$('#' + self.scope.id).find('*[tabindex=\"0\"]').focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Body keyup\n\t\t\tself.dom.on('keyup.Modaal', function(e) {\n\t\t\t\tvar key = e.keyCode;\n\t\t\t\tvar target = e.target;\n\n\t\t\t\tif ( (e.shiftKey && e.keyCode == 9) && self.scope.is_open) {\n\t\t\t\t\t// Watch for shift + tab key press. if open shift focus to close button.\n\t\t\t\t\tif (!$.contains(document.getElementById(self.scope.id), target) ) {\n\t\t\t\t\t\t$('#' + self.scope.id).find('.modaal-close').focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( !self.options.is_locked ){\n\t\t\t\t\t// On escape key press close modal\n\t\t\t\t\tif (key == 27 && self.scope.is_open ) {\n\t\t\t\t\t\tif ( $(document.activeElement).is('input:not(:checkbox):not(:radio)') ) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself.modaal_close();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// is gallery open and images length is > 1\n\t\t\t\tif ( self.options.type == 'image' ) {\n\t\t\t\t\t// arrow left for back\n\t\t\t\t\tif (key == 37 && self.scope.is_open && (!$('#' + self.scope.id + ' .modaal-gallery-prev').hasClass('is_hidden')) ) {\n\t\t\t\t\t\tself.gallery_update('prev');\n\t\t\t\t\t}\n\t\t\t\t\t// arrow right for next\n\t\t\t\t\tif (key == 39 && self.scope.is_open && (!$('#' + self.scope.id + ' .modaal-gallery-next').hasClass('is_hidden')) ) {\n\t\t\t\t\t\tself.gallery_update('next');\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Body click/touch\n\t\t\tself.dom.on('click.Modaal', function(e) {\n\t\t\t\tvar trigger = $(e.target);\n\n\t\t\t\t// General Controls: If it's not locked allow greedy close\n\t\t\t\tif ( !self.options.is_locked ){\n\t\t\t\t\tif ( (self.options.overlay_close && trigger.is('.modaal-inner-wrapper')) || trigger.is('.modaal-close') || trigger.closest('.modaal-close').length ) {\n\t\t\t\t\t\tself.modaal_close();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//Confirm Controls\n\t\t\t\tif ( trigger.is('.modaal-confirm-btn' ) ){\n\t\t\t\t\t// if 'OK' button is clicked, run confirm_callback()\n\t\t\t\t\tif ( trigger.is('.modaal-ok') ) {\n\t\t\t\t\t\tself.options.confirm_callback.call(self, self.lastFocus);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( trigger.is('.modaal-cancel') ) {\n\t\t\t\t\t\tself.options.confirm_cancel_callback.call(self, self.lastFocus);\n\t\t\t\t\t}\n\t\t\t\t\tself.modaal_close();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Gallery Controls\n\t\t\t\tif ( trigger.is( '.modaal-gallery-control' ) ){\n\t\t\t\t\t// it not active, don't do nuthin!\n\t\t\t\t\tif ( trigger.hasClass('is_hidden') ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// trigger previous\n\t\t\t\t\tif ( trigger.is('.modaal-gallery-prev') ) {\n\t\t\t\t\t\tself.gallery_update('prev');\n\t\t\t\t\t}\n\t\t\t\t\t// trigger next\n\t\t\t\t\tif ( trigger.is('.modaal-gallery-next') ) {\n\t\t\t\t\t\tself.gallery_update('next');\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t// Append markup into DOM\n\t\tbuild_modal : function(content) {\n\t\t\tvar self = this;\n\n\t\t\t// if is instagram\n\t\t\tvar igClass = '';\n\t\t\tif ( self.options.type == 'instagram' ) {\n\t\t\t\tigClass = ' modaal-instagram';\n\t\t\t}\n\n\t\t\tvar wrap_class = (self.options.type == 'video') ? 'modaal-video-wrap' : 'modaal-content';\n\n\t\t\t/*\n\t\t\t\tmodaal-start_none : fully hidden via display:none;\n\t\t\t\tmodaal-start_fade : hidden via opacity:0\n\t\t\t\tmodaal-start_slidedown : ...\n\n\t\t\t*/\n\t\t\tvar animation_class;\n\t\t\tswitch ( self.options.animation ) {\n\t\t\t\tcase 'fade' :\n\t\t\t\t\tanimation_class = ' modaal-start_fade';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'slide-down' :\n\t\t\t\t\tanimation_class = ' modaal-start_slidedown';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault :\n\t\t\t\t\tanimation_class = ' modaal-start_none'\n\t\t\t}\n\n\t\t\t// fullscreen check\n\t\t\tvar fullscreen_class = '';\n\t\t\tif ( self.options.fullscreen ) {\n\t\t\t\tfullscreen_class = ' modaal-fullscreen';\n\t\t\t}\n\n\t\t\t// custom class check\n\t\t\tif ( self.options.custom_class !== '' || typeof(self.options.custom_class) !== 'undefined' ) {\n\t\t\t\tself.options.custom_class = ' ' + self.options.custom_class;\n\t\t\t}\n\n\t\t\t// if width and heights exists and is typeof number\n\t\t\tvar dimensionsStyle = '';\n\t\t\tif ( self.options.width && self.options.height && typeof self.options.width == 'number' && typeof self.options.height == 'number' ) {\n\t\t\t\t// if width and height exist, and they are both numbers\n\t\t\t\tdimensionsStyle = ' style=\"max-width:' + self.options.width + 'px;height:' + self.options.height + 'px;overflow:auto;\"';\n\t\t\t} else if ( self.options.width && typeof self.options.width == 'number' ) {\n\t\t\t\t// if only width\n\t\t\t\tdimensionsStyle = ' style=\"max-width:' + self.options.width + 'px;\"';\n\t\t\t} else if ( self.options.height && typeof self.options.height == 'number' ) {\n\t\t\t\t// if only height\n\t\t\t\tdimensionsStyle = ' style=\"height:' + self.options.height + 'px;overflow:auto;\"';\n\t\t\t}\n\n\t\t\t// Reset dimensions style (width and height) for certain types\n\t\t\tif ( self.options.type == 'image' || self.options.type == 'video' || self.options.type == 'instagram' || self.options.fullscreen ) {\n\t\t\t\tdimensionsStyle = '';\n\t\t\t}\n\n\t\t\t// if is touch\n\t\t\t// this is a bug fix for iOS to allow regular click events on div elements.\n\t\t\tvar touchTrigger = '';\n\t\t\tif ( self.is_touch() ) {\n\t\t\t\ttouchTrigger = ' style=\"cursor:pointer;\"'\n\t\t\t}\n\n\t\t\tvar build_markup = '<div class=\"modaal-wrapper modaal-' + self.options.type + animation_class + igClass + fullscreen_class + self.options.custom_class + '\" id=\"' + self.scope.id + '\"><div class=\"modaal-outer-wrapper\"><div class=\"modaal-inner-wrapper\"' + touchTrigger + '>';\n\n\t\t\t\t\t// hide if video\n\t\t\t\t\tif (self.options.type != 'video') {\n\t\t\t\t\t\tbuild_markup += '<div class=\"modaal-container\"' + dimensionsStyle + '>';\n\t\t\t\t\t}\n\n\t\t\t\t\t// add the guts of the content\n\t\t\t\t\tbuild_markup +=\t'<div class=\"' + wrap_class + ' modaal-focus\" aria-hidden=\"false\" aria-label=\"' + self.options.accessible_title + ' - ' + self.options.close_aria_label + '\" role=\"dialog\">';\n\n\t\t\t\t\t\t\t// If it's inline type, we want to clone content instead of dropping it straight in\n\t\t\t\t\t\t\tif (self.options.type == 'inline') {\n\t\t\t\t\t\t\t\tbuild_markup += '<div class=\"modaal-content-container\" role=\"document\"></div>';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Drop in the content if it's not inline\n\t\t\t\t\t\t\t\tbuild_markup +=\tcontent;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t// close wrap_class\n\t\t\t\t\tbuild_markup += '</div>' + self.scope.close_btn;\n\n\t\t\t\t\t// hide if video\n\t\t\t\t\tif (self.options.type != 'video') {\n\t\t\t\t\t\tbuild_markup += '</div>';\n\t\t\t\t\t}\n\n\t\t\t// close off modaal-inner-wrapper\n\t\t\tbuild_markup +=\t'</div>';\n\t\t\t\n\t\t\t// If type is image AND outer_controls is true: add gallery next and previous controls.\n\t\t\tif (self.options.type == 'image' && self.options.outer_controls === true) {\n\t\t\t\tbuild_markup += self.scope.prev_btn + self.scope.next_btn;\n\t\t\t}\n\n\t\t\t// close off modaal-wrapper\n\t\t\tbuild_markup +=\t'</div></div>';\n\n\t\t\t// append ajax modal markup to dom\n\t\t\tif ($('#' + self.scope.id + '_overlay').length < 1) {\n\t\t\t\tself.dom.append(build_markup);\n\t\t\t}\n\n\t\t\t// if inline, clone content into space\n\t\t\tif (self.options.type == 'inline') {\n\t\t\t\tcontent.appendTo('#' + self.scope.id + ' .modaal-content-container');\n\t\t\t}\n\n\t\t\t// Trigger overlay show (which triggers modal show)\n\t\t\tself.modaal_overlay('show');\n\t\t},\n\n\t\t// Create Basic Inline Modal\n\t\t// ----------------------------------------------------------------\n\t\tcreate_basic : function() {\n\t\t\tvar self = this;\n\t\t\tvar target = $(self.scope.source);\n\t\t\tvar content = '';\n\n\t\t\tif (target.length) {\n\t\t\t\tcontent = target.contents().detach();\n\t\t\t\ttarget.empty();\n\t\t\t} else {\n\t\t\t\tcontent = 'Content could not be loaded. Please check the source and try again.';\n\t\t\t}\n\n\t\t\t// now push content into markup\n\t\t\tself.build_modal(content);\n\t\t},\n\n\t\t// Create Instagram Modal\n\t\t// ----------------------------------------------------------------\n\t\tcreate_instagram : function() {\n\t\t\tvar self = this;\n\t\t\tvar id = self.options.instagram_id;\n\t\t\tvar content = '';\n\n\t\t\tvar error_msg = 'Instagram photo couldn\\'t be loaded, please check the embed code and try again.';\n\n\t\t\tself.build_modal('<div class=\"modaal-content-container' + ( self.options.loading_class != '' ? ' ' + self.options.loading_class : '' ) + '\">' + self.options.loading_content + '</div>' );\n\n\t\t\t// ID exists, is not empty null or undefined.\n\t\t\tif ( id != '' && id !== null && id !== undefined ) {\n\t\t\t\t// set up oembed url\n\t\t\t\tvar ig_url = 'https://api.instagram.com/oembed?url=http://instagr.am/p/' + id + '/';\n\n\t\t\t\t$.ajax({\n\t\t\t\t\turl: ig_url,\n\t\t\t\t\tdataType: \"jsonp\",\n\t\t\t\t\tcache: false,\n\t\t\t\t\tsuccess: function (data) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Create temp dom element from which we'll clone into the modaal instance. This is required to bypass the unusual small thumb issue instagram oembed was serving up\n\t\t\t\t\t\tself.dom.append('<div id=\"temp-ig\" style=\"width:0;height:0;overflow:hidden;\">' + data.html + '</div>');\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Check if it has loaded once before.\n\t\t\t\t\t\t// This is to stop the Embeds.process from throwing and error the first time it's being loaded.\n\t\t\t\t\t\t// private_options are individual to a modaal_scope so will not work across multiple scopes when checking if true, only that one item.\n\t\t\t\t\t\tif ( self.dom.attr('data-igloaded') ) {\n\t\t\t\t\t\t\twindow.instgrm.Embeds.process();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// first time it's loaded, let's set a new private option to use next time it's opened.\n\t\t\t\t\t\t\tself.dom.attr('data-igloaded', 'true');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// now set location for new content\n\t\t\t\t\t\t// timeout is required as well to bypass the unusual small thumb issue instagram oembed was serving up\n\t\t\t\t\t\tvar target = '#' + self.scope.id + ' .modaal-content-container';\n\t\t\t\t\t\tif ( $(target).length > 0) {\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t$('#temp-ig').contents().clone().appendTo( target );\n\t\t\t\t\t\t\t\t$('#temp-ig').remove();\n\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t},\n\t\t\t\t\terror: function() {\n\t\t\t\t\t\tcontent = error_msg;\n\n\t\t\t\t\t\t// now set location for new content\n\t\t\t\t\t\tvar target = $('#' + self.scope.id + ' .modaal-content-container');\n\t\t\t\t\t\tif ( target.length > 0) {\n\t\t\t\t\t\t\ttarget.removeClass( self.options.loading_class ).addClass( self.options.ajax_error_class );\n\t\t\t\t\t\t\ttarget.html(content);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t} else {\n\t\t\t\tcontent = error_msg;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t// Fetch Ajax Data\n\t\t// ----------------------------------------------------------------\n\t\tfetch_ajax : function(url) {\n\t\t\tvar self = this;\n\t\t\tvar content = '';\n\n\t\t\t// If no accessible title, set it to 'Dialog Window'\n\t\t\tif ( self.options.accessible_title == null ) {\n\t\t\t\tself.options.accessible_title = 'Dialog Window'\n\t\t\t}\n\n\t\t\tif ( self.xhr !== null ){\n\t\t\t\tself.xhr.abort();\n\t\t\t\tself.xhr = null;\n\t\t\t}\n\n\t\t\tself.build_modal('<div class=\"modaal-content-container' + ( self.options.loading_class != '' ? ' ' + self.options.loading_class : '' ) + '\">' + self.options.loading_content + '</div>' );\n\n\t\t\tself.xhr = $.ajax(url, {\n\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t// content fetch is successful so push it into markup\n\t\t\t\t\tvar target = $('#' + self.scope.id).find('.modaal-content-container');\n\t\t\t\t\tif ( target.length > 0){\n\t\t\t\t\t\ttarget.removeClass( self.options.loading_class );\n\t\t\t\t\t\ttarget.html( data );\n\n\t\t\t\t\t\tself.options.ajax_success.call(self, target);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function( xhr ) {\n\t\t\t\t\t// There were some errors so return an error message\n\t\t\t\t\tif ( xhr.statusText == 'abort' ){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar target = $('#' + self.scope.id + ' .modaal-content-container');\n\t\t\t\t\tif ( target.length > 0){\n\t\t\t\t\t\ttarget.removeClass( self.options.loading_class ).addClass( self.options.ajax_error_class );\n\t\t\t\t\t\ttarget.html( 'Content could not be loaded. Please check the source and try again.' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t// Create Confirm Modal\n\t\t// ----------------------------------------------------------------\n\t\tcreate_confirm : function() {\n\t\t\tvar self = this;\n\t\t\tvar content;\n\n\t\t\tcontent = '<div class=\"modaal-content-container\">' +\n\t\t\t\t\t'<h1 id=\"modaal-title\">' + self.options.confirm_title + '</h1>' +\n\t\t\t\t\t'<div class=\"modaal-confirm-content\">' + self.options.confirm_content + '</div>' +\n\t\t\t\t\t\t'<div class=\"modaal-confirm-wrap\">' +\n\t\t\t\t\t\t\t'<button type=\"button\" class=\"modaal-confirm-btn modaal-ok\" aria-label=\"Confirm\">' + self.options.confirm_button_text + '</button>' +\n\t\t\t\t\t\t\t'<button type=\"button\" class=\"modaal-confirm-btn modaal-cancel\" aria-label=\"Cancel\">' + self.options.confirm_cancel_button_text + '</button>' +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>';\n\n\t\t\t// now push content into markup\n\t\t\tself.build_modal(content);\n\t\t},\n\n\t\t// Create Image/Gallery Modal\n\t\t// ----------------------------------------------------------------\n\t\tcreate_image : function() {\n\t\t\tvar self = this;\n\t\t\tvar content;\n\n\t\t\tvar modaal_image_markup = '';\n\t\t\tvar gallery_total;\n\t\t\t\n\t\t\t// If has group attribute\n\t\t\tif ( self.$elem.is('[data-group]') || self.$elem.is('[rel]') ) {\n\n\t\t\t\t// find gallery groups\n\t\t\t\tvar use_group = self.$elem.is('[data-group]');\n\t\t\t\tvar gallery_group = use_group ? self.$elem.attr('data-group') : self.$elem.attr('rel');\n\t\t\t\tvar gallery_group_items = use_group ? $('[data-group=\"' + gallery_group + '\"]') : $('[rel=\"' + gallery_group + '\"]');\n\n\t\t\t\t// remove any previous active attribute to any in the group\n\t\t\t\tgallery_group_items.removeAttr('data-gallery-active', 'is_active');\n\t\t\t\t// add active attribute to the item clicked\n\t\t\t\tself.$elem.attr('data-gallery-active', 'is_active');\n\n\t\t\t\t// how many in the grouping are there (-1 to connect with each function starting with 0)\n\t\t\t\tgallery_total = gallery_group_items.length - 1;\n\n\t\t\t\t// prepare array for gallery data\n\t\t\t\tvar gallery = [];\n\n\t\t\t\t// start preparing markup\n\t\t\t\tmodaal_image_markup = '<div class=\"modaal-gallery-item-wrap\">';\n\n\t\t\t\t// loop each grouping item and push it into our gallery array\n\t\t\t\tgallery_group_items.each(function(i, item) {\n\t\t\t\t\t// setup default content\n\t\t\t\t\tvar img_src = '';\n\t\t\t\t\tvar img_alt = '';\n\t\t\t\t\tvar img_description = '';\n\t\t\t\t\tvar img_active = false;\n\t\t\t\t\tvar img_src_error = false;\n\n\t\t\t\t\tvar data_modaal_desc = item.getAttribute('data-modaal-desc');\n\t\t\t\t\tvar data_item_active = item.getAttribute('data-gallery-active');\n\n\t\t\t\t\t// if item has inline custom source, use that instead of href. Fall back to href if available.\n\t\t\t\t\tif ( $(item).attr('data-modaal-content-source') ) {\n\t\t\t\t\t\timg_src = $(item).attr('data-modaal-content-source');\n\t\t\t\t\t} else if ( $(item).attr('href') ) {\n\t\t\t\t\t\timg_src = $(item).attr('href');\n\t\t\t\t\t} else if ( $(item).attr('src') ) {\n\t\t\t\t\t\timg_src = $(item).attr('src');\n\t\t\t\t\t} else {\n\t\t\t\t\t\timg_src = 'trigger requires href or data-modaal-content-source attribute';\n\t\t\t\t\t\timg_src_error = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Does it have a modaal description\n\t\t\t\t\tif ( data_modaal_desc != '' && data_modaal_desc !== null && data_modaal_desc !== undefined ) {\n\t\t\t\t\t\timg_alt = data_modaal_desc;\n\t\t\t\t\t\timg_description = '<div class=\"modaal-gallery-label\"><span class=\"modaal-accessible-hide\">Image ' + (i+1) + ' - </span>' + data_modaal_desc.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\") + '</div>'\n\t\t\t\t\t} else {\n\t\t\t\t\t\timg_description = '<div class=\"modaal-gallery-label\"><span class=\"modaal-accessible-hide\">Image ' + (i+1) + '</span></div>';\n\t\t\t\t\t}\n\n\t\t\t\t\t// is it the active item\n\t\t\t\t\tif ( data_item_active ) {\n\t\t\t\t\t\timg_active = true\n\t\t\t\t\t}\n\n\t\t\t\t\t// set new object for values we want\n\t\t\t\t\tvar gallery_item = {\n\t\t\t\t\t\t'url': img_src,\n\t\t\t\t\t\t'alt': img_alt,\n\t\t\t\t\t\t'rawdesc': data_modaal_desc,\n\t\t\t\t\t\t'desc': img_description,\n\t\t\t\t\t\t'active': img_active,\n\t\t\t\t\t\t'src_error': img_src_error\n\t\t\t\t\t};\n\n\t\t\t\t\t// push object into gallery array\n\t\t\t\t\tgallery.push( gallery_item );\n\t\t\t\t});\n\n\t\t\t\t// now loop through all items in the gallery and build up the markup\n\t\t\t\tfor (var i = 0; i < gallery.length; i++) {\n\t\t\t\t\t// Set default active class, then check if array item active is true and update string for class\n\t\t\t\t\tvar is_active = '';\n\t\t\t\t\tvar aria_label = gallery[i].rawdesc ? 'Image: ' + gallery[i].rawdesc : 'Image ' + i + ' no description';\n\n\t\t\t\t\tif ( gallery[i].active ) {\n\t\t\t\t\t\tis_active = ' ' + self.private_options.active_class;\n\t\t\t\t\t}\n\n\t\t\t\t\t// if gallery item has source error, output message rather than undefined image\n\t\t\t\t\tvar image_output = gallery[i].src_error ? gallery[i].url : '<img src=\"' + gallery[i].url + '\" alt=\" \" style=\"width:100%\">';\n\n\t\t\t\t\t// for each item build up the markup\n\t\t\t\t\tmodaal_image_markup += '<div class=\"modaal-gallery-item gallery-item-' + i + is_active + '\" aria-label=\"' + aria_label + '\">' +\n\t\t\t\t\t\timage_output + gallery[i].desc +\n\t\t\t\t\t'</div>';\n\t\t\t\t}\n\n\t\t\t\t// Close off the markup for the gallery\n\t\t\t\tmodaal_image_markup += '</div>';\n\n\t\t\t\t// Add next and previous buttons if outside\n\t\t\t\tif (self.options.outer_controls != true) {\n\t\t\t\t\tmodaal_image_markup += self.scope.prev_btn + self.scope.next_btn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// This is only a single gallery item so let's grab the necessary values\n\n\t\t\t\t// define the source, check if content_source option exists, and use that or fall back to href.\n\t\t\t\tvar this_img_src;\n\t\t\t\tvar img_src_error = false;\n\t\t\t\tif ( self.$elem.attr('data-modaal-content-source') ) {\n\t\t\t\t\tthis_img_src = self.$elem.attr('data-modaal-content-source');\n\t\t\t\t} else if ( self.$elem.attr('href') ) {\n\t\t\t\t\tthis_img_src = self.$elem.attr('href');\n\t\t\t\t} else if ( self.$elem.attr('src') ) {\n\t\t\t\t\tthis_img_src = self.$elem.attr('src');\n\t\t\t\t} else {\n\t\t\t\t\tthis_img_src = 'trigger requires href or data-modaal-content-source attribute';\n\t\t\t\t\timg_src_error = true;\n\t\t\t\t}\n\n\t\t\t\tvar this_img_alt_txt = '';\n\t\t\t\tvar this_img_alt = '';\n\t\t\t\tvar aria_label = '';\n\n\t\t\t\tif ( self.$elem.attr('data-modaal-desc') ) {\n\t\t\t\t\taria_label = self.$elem.attr('data-modaal-desc');\n\t\t\t\t\tthis_img_alt_txt = self.$elem.attr('data-modaal-desc');\n\t\t\t\t\tthis_img_alt = '<div class=\"modaal-gallery-label\"><span class=\"modaal-accessible-hide\">Image - </span>' + this_img_alt_txt.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\") + '</div>';\n\t\t\t\t} else {\n\t\t\t\t\taria_label = \"Image with no description\";\n\t\t\t\t}\n\n\t\t\t\t// if image item has source error, output message rather than undefined image\n\t\t\t\tvar image_output = img_src_error ? this_img_src : '<img src=\"' + this_img_src + '\" alt=\" \" style=\"width:100%\">';\n\n\t\t\t\t// build up the html\n\t\t\t\tmodaal_image_markup = '<div class=\"modaal-gallery-item is_active\" aria-label=\"' + aria_label + '\">' +\n\t\t\t\t\timage_output + this_img_alt +\n\t\t\t\t'</div>';\n\t\t\t}\n\n\t\t\t// Update content variable\n\t\t\tcontent = modaal_image_markup;\n\n\t\t\t// now push content into markup\n\t\t\tself.build_modal(content);\n\n\t\t\t// setup next & prev buttons\n\t\t\tif ( $('.modaal-gallery-item.is_active').is('.gallery-item-0') ) {\n\t\t\t\t$('.modaal-gallery-prev').hide();\n\t\t\t}\n\t\t\tif ( $('.modaal-gallery-item.is_active').is('.gallery-item-' + gallery_total) ) {\n\t\t\t\t$('.modaal-gallery-next').hide();\n\t\t\t}\n\t\t},\n\n\t\t// Gallery Change Image\n\t\t// ----------------------------------------------------------------\n\t\tgallery_update : function(direction) {\n\t\t\tvar self = this;\n\t\t\tvar this_gallery = $('#' + self.scope.id);\n\t\t\tvar this_gallery_item = this_gallery.find('.modaal-gallery-item');\n\t\t\tvar this_gallery_total = this_gallery_item.length - 1;\n\n\t\t\t// if single item, don't proceed\n\t\t\tif ( this_gallery_total == 0 ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar prev_btn = this_gallery.find('.modaal-gallery-prev'),\n\t\t\t\tnext_btn = this_gallery.find('.modaal-gallery-next');\n\n\t\t\tvar duration = 250;\n\n\t\t\tvar new_img_w = 0,\n\t\t\t\tnew_img_h = 0;\n\n\t\t\t// CB: Before image change\n\t\t\tvar current_item = this_gallery.find( '.modaal-gallery-item.' + self.private_options.active_class ),\n\t\t\t\tincoming_item = ( direction == 'next' ? current_item.next( '.modaal-gallery-item' ) : current_item.prev( '.modaal-gallery-item' ) );\n\t\t\tself.options.before_image_change.call(self, current_item, incoming_item);\n\n\t\t\t// stop change if at start of end\n\t\t\tif ( direction == 'prev' && this_gallery.find('.gallery-item-0').hasClass('is_active') ) {\n\t\t\t\treturn false;\n\t\t\t} else if ( direction == 'next' && this_gallery.find('.gallery-item-' + this_gallery_total).hasClass('is_active') ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\n\t\t\t// lock dimensions\n\t\t\tcurrent_item.stop().animate({\n\t\t\t\topacity: 0\n\t\t\t}, duration, function(){\n\t\t\t\t// Move to appropriate image\n\t\t\t\tincoming_item.addClass('is_next').css({\n\t\t\t\t\t'position': 'absolute',\n\t\t\t\t\t'display': 'block',\n\t\t\t\t\t'opacity': 0\n\t\t\t\t});\n\n\t\t\t\t// Collect doc width\n\t\t\t\tvar doc_width = $(document).width();\n\t\t\t\tvar width_threshold = doc_width > 1140 ? 280 : 50;\n\n\t\t\t\t// start toggle to 'is_next'\n\t\t\t\tnew_img_w = this_gallery.find('.modaal-gallery-item.is_next').width();\n\t\t\t\tnew_img_h = this_gallery.find('.modaal-gallery-item.is_next').height();\n\n\t\t\t\tvar new_natural_w = this_gallery.find('.modaal-gallery-item.is_next img').prop('naturalWidth');\n\t\t\t\tvar new_natural_h = this_gallery.find('.modaal-gallery-item.is_next img').prop('naturalHeight');\n\n\t\t\t\t// if new image is wider than doc width\n\t\t\t\tif ( new_natural_w > (doc_width - width_threshold) ) {\n\t\t\t\t\t// set new width just below doc width\n\t\t\t\t\tnew_img_w = doc_width - width_threshold;\n\n\t\t\t\t\t// Set temp widths so we can calulate the correct height;\n\t\t\t\t\tthis_gallery.find('.modaal-gallery-item.is_next').css({ 'width': new_img_w });\n\t\t\t\t\tthis_gallery.find('.modaal-gallery-item.is_next img').css({ 'width': new_img_w });\n\n\t\t\t\t\t// Set new height variable\n\t\t\t\t\tnew_img_h = this_gallery.find('.modaal-gallery-item.is_next').find('img').height();\n\t\t\t\t} else {\n\t\t\t\t\t// new img is not wider than screen, so let's set the new dimensions\n\t\t\t\t\tnew_img_w = new_natural_w;\n\t\t\t\t\tnew_img_h = new_natural_h;\n\t\t\t\t}\n\n\t\t\t\t// resize gallery region\n\t\t\t\tthis_gallery.find('.modaal-gallery-item-wrap').stop().animate({\n\t\t\t\t\t'width': new_img_w,\n\t\t\t\t\t'height': new_img_h\n\t\t\t\t}, duration, function() {\n\t\t\t\t\t// hide old active image\n\t\t\t\t\tcurrent_item.removeClass(self.private_options.active_class + ' ' + self.options.gallery_active_class).removeAttr('style');\n\t\t\t\t\tcurrent_item.find('img').removeAttr('style');\n\n\t\t\t\t\t// show new image\n\t\t\t\t\tincoming_item.addClass(self.private_options.active_class + ' ' + self.options.gallery_active_class).removeClass('is_next').css('position','');\n\n\t\t\t\t\t// animate in new image (now has the normal is_active class\n\t\t\t\t\tincoming_item.stop().animate({\n\t\t\t\t\t\topacity: 1\n\t\t\t\t\t}, duration, function(){\n\t\t\t\t\t\t$(this).removeAttr('style').css({\n\t\t\t\t\t\t\t'width': '100%'\n\t\t\t\t\t\t});\n\t\t\t\t\t\t$(this).find('img').css('width', '100%');\n\n\t\t\t\t\t\t// remove dimension lock\n\t\t\t\t\t\tthis_gallery.find('.modaal-gallery-item-wrap').removeAttr('style');\n\n\t\t\t\t\t\t// CB: After image change\n\t\t\t\t\t\tself.options.after_image_change.call( self, incoming_item );\n\t\t\t\t\t});\n\n\t\t\t\t\t// Focus on the new gallery item\n\t\t\t\t\tthis_gallery.find('.modaal-gallery-item').removeAttr('tabindex');\n\t\t\t\t\tthis_gallery.find('.modaal-gallery-item.' + self.private_options.active_class + '').attr('tabindex', '0').focus();\n\n\t\t\t\t\t// hide/show next/prev\n\t\t\t\t\tif ( this_gallery.find('.modaal-gallery-item.' + self.private_options.active_class).is('.gallery-item-0') ) {\n\t\t\t\t\t\tprev_btn.stop().animate({\n\t\t\t\t\t\t\topacity: 0\n\t\t\t\t\t\t}, 150, function(){\n\t\t\t\t\t\t\t$(this).hide();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprev_btn.stop().css({\n\t\t\t\t\t\t\t'display': 'block',\n\t\t\t\t\t\t\t'opacity': prev_btn.css('opacity')\n\t\t\t\t\t\t}).animate({\n\t\t\t\t\t\t\topacity: 1\n\t\t\t\t\t\t}, 150);\n\t\t\t\t\t}\n\t\t\t\t\tif ( this_gallery.find('.modaal-gallery-item.' + self.private_options.active_class).is('.gallery-item-' + this_gallery_total) ) {\n\t\t\t\t\t\tnext_btn.stop().animate({\n\t\t\t\t\t\t\topacity: 0\n\t\t\t\t\t\t}, 150, function(){\n\t\t\t\t\t\t\t$(this).hide();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnext_btn.stop().css({\n\t\t\t\t\t\t\t'display': 'block',\n\t\t\t\t\t\t\t'opacity': prev_btn.css('opacity')\n\t\t\t\t\t\t}).animate({\n\t\t\t\t\t\t\topacity: 1\n\t\t\t\t\t\t}, 150);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t// Create Video Modal\n\t\t// ----------------------------------------------------------------\n\t\tcreate_video : function(url) {\n\t\t\tvar self = this;\n\t\t\tvar content;\n\n\t\t\t// video markup\n\t\t\tcontent = '<iframe src=\"' + url + '\" class=\"modaal-video-frame\" frameborder=\"0\" allowfullscreen></iframe>';\n\n\t\t\t// now push content into markup\n\t\t\tself.build_modal('<div class=\"modaal-video-container\">' + content + '</div>');\n\t\t},\n\n\t\t// Create iFrame Modal\n\t\t// ----------------------------------------------------------------\n\t\tcreate_iframe : function(url) {\n\t\t\tvar self = this;\n\t\t\tvar content;\n\n\t\t\tif ( self.options.width !== null || self.options.width !== undefined || self.options.height !== null || self.options.height !== undefined ) {\n\t\t\t\t// video markup\n\t\t\t\tcontent = '<iframe src=\"' + url + '\" class=\"modaal-iframe-elem\" frameborder=\"0\" allowfullscreen></iframe>';\n\t\t\t} else {\n\t\t\t\tcontent = '<div class=\"modaal-content-container\">Please specify a width and height for your iframe</div>';\n\t\t\t}\n\n\t\t\t// now push content into markup\n\t\t\tself.build_modal(content);\n\t\t},\n\n\t\t// Open Modaal\n\t\t// ----------------------------------------------------------------\n\t\tmodaal_open : function() {\n\t\t\tvar self = this;\n\t\t\tvar modal_wrapper = $( '#' + self.scope.id );\n\t\t\tvar animation_type = self.options.animation;\n\n\t\t\tif (animation_type === 'none' ){\n\t\t\t\tmodal_wrapper.removeClass('modaal-start_none');\n\t\t\t\tself.options.after_open.call(self, modal_wrapper);\n\t\t\t}\n\n\t\t\t// Open with fade\n\t\t\tif (animation_type === 'fade') {\n\t\t\t\tmodal_wrapper.removeClass('modaal-start_fade');\n\t\t\t}\n\n\t\t\t// Open with slide down\n\t\t\tif (animation_type === 'slide-down') {\n\t\t\t\tmodal_wrapper.removeClass('modaal-start_slide_down');\n\t\t\t}\n\n\t\t\tvar focusTarget = modal_wrapper;\n\n\t\t\t// Switch focusTarget tabindex (switch from other modal if exists)\n\t\t\t$('.modaal-wrapper *[tabindex=0]').removeAttr('tabindex');\n\n\t\t\tif ( self.options.type == 'image' ) {\n\t\t\t\tfocusTarget = $('#' + self.scope.id).find('.modaal-gallery-item.' + self.private_options.active_class);\n\n\t\t\t} else if ( modal_wrapper.find('.modaal-iframe-elem').length ) {\n\t\t\t\tfocusTarget = modal_wrapper.find('.modaal-iframe-elem');\n\n\t\t\t} else if ( modal_wrapper.find('.modaal-video-wrap').length ) {\n\t\t\t\tfocusTarget = modal_wrapper.find('.modaal-video-wrap');\n\n\t\t\t} else {\n\t\t\t\tfocusTarget = modal_wrapper.find('.modaal-focus');\n\n\t\t\t}\n\n\t\t\t// now set the focus\n\t\t\tfocusTarget.attr('tabindex', '0').focus();\n\n\t\t\t// Run after_open\n\t\t\tif (animation_type !== 'none') {\n\t\t\t\t// CB: after_open\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tself.options.after_open.call(self, modal_wrapper)\n\t\t\t\t}, self.options.after_callback_delay);\n\t\t\t}\n\t\t},\n\n\t\t// Close Modal\n\t\t// ----------------------------------------------------------------\n\t\tmodaal_close : function() {\n\t\t\tvar self = this;\n\t\t\tvar modal_wrapper = $( '#' + self.scope.id );\n\n\t\t\t// CB: before_close\n\t\t\tself.options.before_close.call(self, modal_wrapper);\n\n\t\t\tif (self.xhr !== null){\n\t\t\t\tself.xhr.abort();\n\t\t\t\tself.xhr = null;\n\t\t\t}\n\n\t\t\t// Now we close the modal\n\t\t\tif (self.options.animation === 'none' ){\n\t\t\t\tmodal_wrapper.addClass('modaal-start_none');\n\t\t\t}\n\n\t\t\t// Close with fade\n\t\t\tif (self.options.animation === 'fade') {\n\t\t\t\tmodal_wrapper.addClass('modaal-start_fade');\n\t\t\t}\n\n\t\t\t// Close with slide up (using initial slide down)\n\t\t\tif (self.options.animation === 'slide-down') {\n\t\t\t\tmodal_wrapper.addClass('modaal-start_slide_down');\n\t\t\t}\n\n\t\t\t// CB: after_close and remove\n\t\t\tsetTimeout(function() {\n\t\t\t\t// clone inline content back to origin place\n\t\t\t\tif (self.options.type == 'inline') {\n\t\t\t\t\t$('#' + self.scope.id + ' .modaal-content-container').contents().detach().appendTo( self.scope.source )\n\t\t\t\t}\n\t\t\t\t// remove markup from dom\n\t\t\t\tmodal_wrapper.remove();\n\t\t\t\t// CB: after_close\n\t\t\t\tself.options.after_close.call(self);\n\t\t\t\t// scope is now closed\n\t\t\t\tself.scope.is_open = false;\n\n\t\t\t}, self.options.after_callback_delay);\n\n\t\t\t// Call overlay hide\n\t\t\tself.modaal_overlay('hide');\n\n\t\t\t// Roll back to last focus state before modal open. If was closed programmatically, this might not be set\n\t\t\tif (self.lastFocus != null) {\n\t\t\t\tself.lastFocus.focus();\n\t\t\t}\n\t\t},\n\n\t\t// Overlay control (accepts action for show or hide)\n\t\t// ----------------------------------------------------------------\n\t\tmodaal_overlay : function(action) {\n\t\t\tvar self = this;\n\n\t\t\tif (action == 'show') {\n\t\t\t\t// Modal is open so update scope\n\t\t\t\tself.scope.is_open = true;\n\n\t\t\t\t// set body to overflow hidden if background_scroll is false\n\t\t\t\tif (! self.options.background_scroll) {\n\t\t\t\t\tself.dom.addClass('modaal-noscroll');\n\t\t\t\t}\n\n\t\t\t\t// append modaal overlay\n\t\t\t\tif ($('#' + self.scope.id + '_overlay').length < 1) {\n\t\t\t\t\tself.dom.append('<div class=\"modaal-overlay\" id=\"' + self.scope.id + '_overlay\"></div>');\n\t\t\t\t}\n\n\t\t\t\t// now show\n\t\t\t\t$('#' + self.scope.id + '_overlay').css('background', self.options.background).stop().animate({\n\t\t\t\t\topacity: self.options.overlay_opacity\n\t\t\t\t}, self.options.animation_speed, function(){\n\t\t\t\t\t// now open the modal\n\t\t\t\t\tself.modaal_open();\n\t\t\t\t});\n\n\t\t\t} else if (action == 'hide') {\n\n\t\t\t\t// now hide the overlay\n\t\t\t\t$('#' + self.scope.id + '_overlay').stop().animate({\n\t\t\t\t\topacity: 0\n\t\t\t\t}, self.options.animation_speed, function(){\n\t\t\t\t\t// remove overlay from dom\n\t\t\t\t\t$(this).remove();\n\n\t\t\t\t\t// remove body overflow lock\n\t\t\t\t\tself.dom.removeClass('modaal-noscroll');\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t// Check if is touch\n\t\t// ----------------------------------------------------------------\n\t\tis_touch : function() {\n\t\t\treturn 'ontouchstart' in window || navigator.maxTouchPoints;\n\t\t}\n\t};\n\n\t// Define default object to store\n\tvar modaal_existing_selectors = [];\n\n\t// Declare the modaal jQuery method\n\t// ------------------------------------------------------------\n\t$.fn.modaal = function(options) {\n\t\treturn this.each(function (i) {\n\t\t\tvar existing_modaal = $(this).data('modaal');\n\n\t\t\tif ( existing_modaal ){\n\t\t\t\t// Checking for string value, used for methods\n\t\t\t\tif (typeof(options) == 'string'){\n\t\t\t\t\tswitch (options) {\n\t\t\t\t\t\tcase 'open':\n \t\t\t\t\t\t\t// create the modal\n \t\t\t\t\t\t\texisting_modaal.create_modaal(existing_modaal);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'close':\n\t\t\t\t\t\t\texisting_modaal.modaal_close();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Not a string, so let's setup the modal ready to use\n\t\t\t\tvar modaal = Object.create(Modaal);\n\t\t\t\tmodaal.init(options, this);\n\t\t\t\t$.data(this, \"modaal\", modaal);\n\n\t\t\t\t// push this select into existing selectors array which is referenced during modaal_dom_observer\n\t\t\t\tmodaal_existing_selectors.push({\n\t\t\t\t\t'element': $(this).attr('class'),\n\t\t\t\t\t'options': options\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\t// Default options\n\t// ------------------------------------------------------------\n\t$.fn.modaal.options = {\n\n\t\t//General\n\t\ttype: 'inline',\n\t\tcontent_source: null,\n\t\tanimation: 'fade',\n\t\tanimation_speed: 300,\n\t\tafter_callback_delay: 350,\n\t\tis_locked: false,\n\t\thide_close: false,\n\t\tbackground: '#000',\n\t\toverlay_opacity: '0.8',\n\t\toverlay_close: true,\n\t\taccessible_title: 'Dialog Window',\n\t\tstart_open: false,\n\t\tfullscreen: false,\n\t\tcustom_class: '',\n\t\tbackground_scroll: true,\n\t\tshould_open: true,\n\t\tclose_text: 'Close',\n\t\tclose_aria_label: 'Close (Press escape to close)',\n\t\twidth: null,\n\t\theight: null,\n\n\t\t//Events\n\t\tbefore_open: function(){},\n\t\tafter_open: function(){},\n\t\tbefore_close: function(){},\n\t\tafter_close: function(){},\n\t\tsource: function( element, src ){\n\t\t\treturn src;\n\t\t},\n\n\t\t//Confirm Modal\n\t\tconfirm_button_text: 'Confirm', // text on confirm button\n\t\tconfirm_cancel_button_text: 'Cancel',\n\t\tconfirm_title: 'Confirm Title', // title for confirm modal\n\t\tconfirm_content: '<p>This is the default confirm dialog content. Replace me through the options</p>', // html for confirm message\n\t\tconfirm_callback: function() {},\n\t\tconfirm_cancel_callback: function() {},\n\n\n\t\t//Gallery Modal\n\t\tgallery_active_class: 'gallery_active_item',\n\t\touter_controls:\tfalse,\n\t\tbefore_image_change: function( current_item, incoming_item ) {},\n\t\tafter_image_change: function( current_item ) {},\n\n\t\t//Ajax Modal\n\t\tloading_content: modaal_loading_spinner,\n\t\tloading_class: 'is_loading',\n\t\tajax_error_class: 'modaal-error',\n\t\tajax_success: function(){},\n\n\t\t//Instagram\n\t\tinstagram_id: null\n\t};\n\n\t// Check and Set Inline Options\n\t// ------------------------------------------------------------\n\tfunction modaal_inline_options(self) {\n\n\t\t// new empty options\n\t\tvar options = {};\n\t\tvar inline_options = false;\n\n\t\t// option: type\n\t\tif ( self.attr('data-modaal-type') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.type = self.attr('data-modaal-type');\n\t\t}\n\n\t\t// option: type\n\t\tif ( self.attr('data-modaal-content-source') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.content_source = self.attr('data-modaal-content-source');\n\t\t}\n\n\t\t// option: animation\n\t\tif ( self.attr('data-modaal-animation') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.animation = self.attr('data-modaal-animation');\n\t\t}\n\n\t\t// option: animation_speed\n\t\tif ( self.attr('data-modaal-animation-speed') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.animation_speed = self.attr('data-modaal-animation-speed');\n\t\t}\n\n\t\t// option: after_callback_delay\n\t\tif ( self.attr('data-modaal-after-callback-delay') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.after_callback_delay = self.attr('data-modaal-after-callback-delay');\n\t\t}\n\n\t\t// option: is_locked\n\t\tif ( self.attr('data-modaal-is-locked') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.is_locked = (self.attr('data-modaal-is-locked') === 'true' ? true : false);\n\t\t}\n\n\t\t// option: hide_close\n\t\tif ( self.attr('data-modaal-hide-close') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.hide_close = (self.attr('data-modaal-hide-close') === 'true' ? true : false);\n\t\t}\n\n\t\t// option: background\n\t\tif ( self.attr('data-modaal-background') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.background = self.attr('data-modaal-background');\n\t\t}\n\n\t\t// option: overlay_opacity\n\t\tif ( self.attr('data-modaal-overlay-opacity') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.overlay_opacity = self.attr('data-modaal-overlay-opacity');\n\t\t}\n\n\t\t// option: overlay_close\n\t\tif ( self.attr('data-modaal-overlay-close') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.overlay_close = (self.attr('data-modaal-overlay-close') === 'false' ? false : true);\n\t\t}\n\n\t\t// option: accessible_title\n\t\tif ( self.attr('data-modaal-accessible-title') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.accessible_title = self.attr('data-modaal-accessible-title');\n\t\t}\n\n\t\t// option: start_open\n\t\tif ( self.attr('data-modaal-start-open') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.start_open = (self.attr('data-modaal-start-open') === 'true' ? true : false);\n\t\t}\n\n\t\t// option: fullscreen\n\t\tif ( self.attr('data-modaal-fullscreen') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.fullscreen = (self.attr('data-modaal-fullscreen') === 'true' ? true : false);\n\t\t}\n\n\t\t// option: custom_class\n\t\tif ( self.attr('data-modaal-custom-class') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.custom_class = self.attr('data-modaal-custom-class');\n\t\t}\n\n\t\t// option: close_text\n\t\tif ( self.attr('data-modaal-close-text') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.close_text = self.attr('data-modaal-close-text');\n\t\t}\n\n\t\t// option: close_aria_label\n\t\tif ( self.attr('data-modaal-close-aria-label') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.close_aria_label = self.attr('data-modaal-close-aria-label');\n\t\t}\n\n\t\t// option: background_scroll\n\t\tif ( self.attr('data-modaal-background-scroll') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.background_scroll = (self.attr('data-modaal-background-scroll') === 'true' ? true : false);\n\t\t}\n\n\t\t// option: width\n\t\tif ( self.attr('data-modaal-width') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.width = parseInt( self.attr('data-modaal-width') );\n\t\t}\n\n\t\t// option: height\n\t\tif ( self.attr('data-modaal-height') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.height = parseInt( self.attr('data-modaal-height') );\n\t\t}\n\n\t\t// option: confirm_button_text\n\t\tif ( self.attr('data-modaal-confirm-button-text') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.confirm_button_text = self.attr('data-modaal-confirm-button-text');\n\t\t}\n\n\t\t// option: confirm_cancel_button_text\n\t\tif ( self.attr('data-modaal-confirm-cancel-button-text') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.confirm_cancel_button_text = self.attr('data-modaal-confirm-cancel-button-text');\n\t\t}\n\n\t\t// option: confirm_title\n\t\tif ( self.attr('data-modaal-confirm-title') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.confirm_title = self.attr('data-modaal-confirm-title');\n\t\t}\n\n\t\t// option: confirm_content\n\t\tif ( self.attr('data-modaal-confirm-content') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.confirm_content = self.attr('data-modaal-confirm-content');\n\t\t}\n\n\t\t// option: gallery_active_class\n\t\tif ( self.attr('data-modaal-gallery-active-class') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.gallery_active_class = self.attr('data-modaal-gallery-active-class');\n\t\t}\n\n\t\t// option: loading_content\n\t\tif ( self.attr('data-modaal-loading-content') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.loading_content = self.attr('data-modaal-loading-content');\n\t\t}\n\n\t\t// option: loading_class\n\t\tif ( self.attr('data-modaal-loading-class') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.loading_class = self.attr('data-modaal-loading-class');\n\t\t}\n\n\t\t// option: ajax_error_class\n\t\tif ( self.attr('data-modaal-ajax-error-class') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.ajax_error_class = self.attr('data-modaal-ajax-error-class');\n\t\t}\n\n\t\t// option: start_open\n\t\tif ( self.attr('data-modaal-instagram-id') ) {\n\t\t\tinline_options = true;\n\t\t\toptions.instagram_id = self.attr('data-modaal-instagram-id');\n\t\t}\n\n\t\t// now set it up for the trigger, but only if inline_options is true\n\t\tif ( inline_options ) {\n\t\t\tself.modaal(options);\n\t\t}\n\t};\n\n\t// On body load (or now, if already loaded), init any modaals defined inline\n\t// Ensure this is done after $.fn.modaal and default options are declared\n\t// ----------------------------------------------------------------\n\t$(function(){\n\n\t\tvar single_modaal = $('.modaal');\n\n\t\t// Check for existing modaal elements\n\t\tif ( single_modaal.length ) {\n\t\t\tsingle_modaal.each(function() {\n\t\t\t\tvar self = $(this);\n\t\t\t\tmodaal_inline_options(self);\n\t\t\t});\n\t\t}\n\n\t\t// Obvserve DOM mutations for newly added triggers\n\t\tvar modaal_dom_observer = new MutationObserver(function(mutations) {\n\t\t\tmutations.forEach(function(mutation) {\n\t\t\t\tif (mutation.addedNodes && mutation.addedNodes.length > 0) {\n\t\t\t\t\t// element added to DOM\n\t\t\t\t\tvar findElement = [].some.call(mutation.addedNodes, function(el) {\n\t\t\t\t\t\tvar elm = $(el);\n\t\t\t\t\t\tif ( elm.is('a') || elm.is('button') ) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif ( elm.hasClass('modaal') ) {\n\t\t\t\t\t\t\t\t// is inline Modaal, initialise options\n\t\t\t\t\t\t\t\tmodaal_inline_options(elm);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// is not inline modaal. Check for existing selector\n\t\t\t\t\t\t\t\tmodaal_existing_selectors.forEach(function(modaalSelector) {\n\t\t\t\t\t\t\t\t\tif ( modaalSelector.element == elm.attr('class') ) {\n\t\t\t\t\t\t\t\t\t\t$(elm).modaal( modaalSelector.options );\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tvar observer_config = {\n\t\t\tsubtree: true,\n\t\t\tattributes: true,\n\t\t\tchildList: true,\n\t\t\tcharacterData: true\n\t\t};\n\n\t\t// pass in the target node, as well as the observer options\n\t\tsetTimeout(function() {\n\t\t\tmodaal_dom_observer.observe(document.body, observer_config);\n\t\t}, 500);\n\n\t});\n\n} ( jQuery, window, document ) );"],"names":["$","Modaal","init","options","elem","mod_class","self","this","dom","$elem","extend","fn","modaal","data","xhr","scope","is_open","id","Date","getTime","Math","random","toString","substring","source","content_source","attr","private_options","active_class","lastFocus","is_locked","type","hide_close","close_btn","close_aria_label","close_text","animation","animation_speed","after_callback_delay","on","e","preventDefault","create_modaal","outer_controls","prev_btn","next_btn","start_open","should_open","before_open","call","create_basic","fetch_ajax","create_confirm","create_image","create_iframe","create_video","create_instagram","watch_events","off","key","keyCode","target","contains","document","getElementById","find","focus","shiftKey","activeElement","is","modaal_close","hasClass","gallery_update","trigger","overlay_close","closest","length","confirm_callback","confirm_cancel_callback","build_modal","content","igClass","animation_class","wrap_class","fullscreen_class","fullscreen","custom_class","dimensionsStyle","width","height","touchTrigger","is_touch","build_markup","accessible_title","append","appendTo","modaal_overlay","contents","detach","empty","ig_url","instagram_id","error_msg","loading_class","loading_content","ajax","url","dataType","cache","success","html","window","instgrm","Embeds","process","setTimeout","clone","remove","error","removeClass","addClass","ajax_error_class","abort","ajax_success","statusText","confirm_title","confirm_content","confirm_button_text","confirm_cancel_button_text","gallery_total","modaal_image_markup","use_group","gallery_group","gallery_group_items","removeAttr","gallery","each","i","item","img_src","img_alt","img_description","img_active","img_src_error","data_modaal_desc","getAttribute","data_item_active","replace","gallery_item","alt","rawdesc","desc","active","src_error","push","is_active","aria_label","this_img_src","this_img_alt","hide","direction","this_gallery","this_gallery_total","new_img_w","new_img_h","current_item","incoming_item","next","prev","before_image_change","stop","animate","opacity","css","position","display","doc_width","width_threshold","new_natural_w","prop","new_natural_h","gallery_active_class","after_image_change","undefined","modaal_open","modal_wrapper","animation_type","after_open","before_close","after_close","action","background_scroll","background","overlay_opacity","navigator","maxTouchPoints","modaal_existing_selectors","modaal_inline_options","inline_options","parseInt","existing_modaal","Object","create","element","src","single_modaal","modaal_dom_observer","MutationObserver","mutations","forEach","mutation","addedNodes","some","el","elm","modaalSelector","observer_config","subtree","attributes","childList","characterData","observe","body","jQuery"],"mappings":"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"}